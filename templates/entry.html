{% extends "base.html" %}

{% block head %}
  <style type="text/css">
    .comment {
      margin-top: 8px;
      margin-bottom: 8px;
      border: 1px solid #DDD;
    }
    .comment .metadata,
    .comment .content {
      padding: 4px;
    }
    .comment .author{
      font-weight: bold;
    }
  </style>
{% end %}

{% block main %}
  {{ modules.Entry(entry) }}

  <div id="comment" class="comments">
    <h3>Comments</h3>
    {% if comments %}
      {% for comment in comments %}
        {{ modules.Comment(comment) }}
      {% end %}
      {% if comment_extra %}
        <div style="text-align:right;">
          <a href="?comment_start={{ str(comment_extra.index) }}">More comments</a>
        </div>
      {% end %}
    {% end %}
    <h4>Leave a comment</h4>
    <form action="/comment" method="post" class="commentform">
      <p>
          <input type="text" name="author" size="20"
            value="{{ current_user.nickname() if current_user else '' }}"/>
          <lable for="author">Name</label> (* required)<br />
      </p>
      <p>
        <input type="text" name="website" size="20" value=""/>
        <lable for="website">Website</label><br />
      </p>
        <textarea name="content" rows="10" cols="50" class="content"></textarea>
        <br />
        (No more than 1000 words.)
      </p>
      <p>
        <input type="submit" value="{{ _("Submit comment") }}" class="submit"/>
      </p>
      <input type="hidden" name="entry_index" value="{{ str(entry.index) }}"/>
      {{ xsrf_form_html() }}
    </form>
  </div>
{% end %}

{% block bottom %}
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js" type="text/javascript"></script>
  <script type="text/javascript">
  //<![CDATA[

    $(function() {
      $("form.commentform").submit(function() {
          var required = ["author", "content"];
          var form = $(this).get(0);
          for (var i = 0; i < required.length; i++) {
              if (!form[required[i]].value) {
                  $(form[required[i]]).select();
                  return false;
              }
          }
          if (form["content"].value.length > 1000) {
              $(form["content"]).select();
              return false;
          }
          return true;
      });
    });

  //]]>
  </script>
{% end %}

